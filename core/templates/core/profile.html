{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile - MCS</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --brand: #ff6b00;
      --brand-d: #e05f00;
      --bg: #f7f7f9;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --success: #16a34a;
      --warning: #f59e0b;
      --info: #0ea5e9;
      --secondary: #64748b;
      --border: #e5e7eb;
      --shadow: 0 8px 24px rgba(0,0,0,.06);
      --radius: 14px;
      --radius-sm: 10px;
      --radius-xs: 8px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Header */
         .header {
       background: var(--brand);
       border-bottom: 1px solid var(--brand-d);
       position: fixed;
       top: 0;
       left: 0;
       right: 0;
       z-index: 1000;
       box-shadow: var(--shadow);
       color: #fff;
       overflow: visible;
     }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.5rem;
      font-weight: 800;
      color: #fff;
      text-decoration: none;
    }

    .logo img {
      height: 40px;
      width: auto;
      display: block;
      object-fit: contain;
    }

    .logo-text {
      font-size: 1.5rem;
      font-weight: 800;
      color: #fff;
    }

         .user-menu {
       position: relative;
       overflow: visible;
       z-index: 1002;
     }

         .user-button {
       display: flex;
       align-items: center;
       gap: 0.5rem;
       background: rgba(255, 255, 255, 0.2);
       border: 1px solid rgba(255, 255, 255, 0.3);
       border-radius: var(--radius-sm);
       padding: 0.5rem 1rem;
       cursor: pointer;
       transition: all 0.2s ease;
       font-weight: 500;
       color: #fff;
       overflow: hidden;
       position: relative;
     }

    .user-button:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
    }

         .user-avatar {
       width: 32px;
       height: 32px;
       background: rgba(255, 255, 255, 0.3);
       border-radius: 50%;
       display: flex;
       align-items: center;
       justify-content: center;
       color: #fff;
       font-weight: 600;
       overflow: hidden;
       position: relative;
       flex-shrink: 0;
     }
     
     .user-avatar img {
       width: 100%;
       height: 100%;
       border-radius: 50%;
       object-fit: cover;
       max-width: 32px;
       max-height: 32px;
       min-width: 32px;
       min-height: 32px;
       display: block;
       position: absolute;
       top: 0;
       left: 0;
       z-index: 2;
     }

    .dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.5rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s ease;
      z-index: 10000;
    }

    .dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      color: var(--text);
      text-decoration: none;
      transition: background 0.2s ease;
      border-bottom: 1px solid var(--border);
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: var(--bg);
      color: var(--brand);
    }

    /* Main Content */
         .main-content {
       margin-top: 80px;
       padding: 2rem;
       max-width: 1200px;
       margin-left: auto;
       margin-right: auto;
       position: relative;
       z-index: 1;
     }

    .page-header {
      margin-bottom: 2rem;
    }

    .page-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .page-subtitle {
      color: var(--muted);
      font-size: 1.1rem;
    }

    /* Profile Grid */
    .profile-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    /* Profile Card */
         .profile-card {
       background: var(--card);
       border-radius: var(--radius);
       box-shadow: var(--shadow);
       overflow: hidden;
       position: relative;
       z-index: 1;
     }

         .profile-header {
       background: linear-gradient(135deg, var(--brand), var(--brand-d));
       color: #fff;
       padding: 2rem;
       text-align: center;
       position: relative;
       overflow: hidden;
       z-index: 1;
     }

         .profile-avatar {
       width: 120px;
       height: 120px;
       border-radius: 50%;
       margin: 0 auto 1rem;
       background: rgba(255, 255, 255, 0.2);
       display: flex;
       align-items: center;
       justify-content: center;
       font-size: 3rem;
       color: #fff;
       font-weight: 700;
       border: 4px solid rgba(255, 255, 255, 0.3);
       overflow: hidden;
       position: relative;
       flex-shrink: 0;
     }

         .profile-avatar img {
       width: 100%;
       height: 100%;
       border-radius: 50%;
       object-fit: cover;
       max-width: 120px;
       max-height: 120px;
       min-width: 120px;
       min-height: 120px;
       display: block;
       position: absolute;
       top: 0;
       left: 0;
     }

    .profile-name {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .profile-username {
      opacity: 0.9;
      font-size: 1rem;
    }

    .profile-stats {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .stat-item {
      text-align: center;
      padding: 1rem;
      background: var(--bg);
      border-radius: var(--radius-sm);
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--brand);
      margin-bottom: 0.25rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Balance & Withheld Amounts Section */
    .balance-section {
      padding: 1.5rem;
      border-top: 1px solid var(--border);
      background: var(--bg);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .available-balance-card {
      background: linear-gradient(135deg, var(--success), #14b8a6);
      border-radius: var(--radius);
      padding: 1.5rem;
      color: #fff;
      box-shadow: 0 4px 12px rgba(22, 163, 74, 0.2);
    }

    .balance-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .balance-header i {
      font-size: 1.5rem;
    }

    .balance-title {
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      opacity: 0.95;
    }

    .balance-amount {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      letter-spacing: -0.5px;
    }

    .balance-description {
      font-size: 0.875rem;
      opacity: 0.9;
      margin: 0;
    }

    .withheld-amounts-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .withheld-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--border);
    }

    .withheld-header i {
      font-size: 1.25rem;
      color: var(--warning);
    }

    .withheld-title {
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      color: var(--text);
    }

    .withheld-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .withheld-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg);
      border-radius: var(--radius-sm);
    }

    .withheld-item-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .withheld-item-icon.withdraw {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .withheld-item-icon.gwc {
      background: rgba(14, 165, 233, 0.1);
      color: var(--info);
    }

    .withheld-item-icon.mesu {
      background: rgba(139, 92, 246, 0.1);
      color: #8b5cf6;
    }

    .withheld-item-content {
      flex: 1;
    }

    .withheld-item-label {
      font-size: 0.875rem;
      color: var(--muted);
      margin-bottom: 0.25rem;
    }

    .withheld-item-amount {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
    }

    .withheld-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      margin-top: 0.5rem;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
      border-radius: var(--radius-sm);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .withheld-total-label {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
    }

    .withheld-total-amount {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--warning);
    }

    /* Savings Actions Section */
    .profile-actions {
      padding: 1.5rem;
      border-top: 1px solid var(--border);
      background: var(--bg);
    }

    .actions-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .actions-title::before {
      content: '';
      width: 4px;
      height: 20px;
      background: var(--brand);
      border-radius: 2px;
    }

    .actions-grid {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .action-btn {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      width: 100%;
      position: relative;
    }

    .action-btn:hover {
      border-color: var(--brand);
      box-shadow: 0 4px 12px rgba(255, 107, 0, 0.15);
      transform: translateY(-2px);
    }

    .action-icon {
      width: 50px;
      height: 50px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: #fff;
      flex-shrink: 0;
    }

    .action-withdraw .action-icon {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }

    .action-gwc .action-icon {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
    }

    .action-mesu .action-icon {
      background: linear-gradient(135deg, #10b981, #059669);
    }

    .action-content {
      flex: 1;
      min-width: 0;
    }

    .action-name {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .action-description {
      font-size: 0.85rem;
      color: var(--muted);
      margin: 0;
      line-height: 1.4;
    }

    .action-arrow {
      color: var(--muted);
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .action-btn:hover .action-arrow {
      color: var(--brand);
      transform: translateX(4px);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideUp 0.3s ease;
      position: relative;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg);
      border-radius: var(--radius) var(--radius) 0 0;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .modal-title i {
      color: var(--brand);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--muted);
      cursor: pointer;
      padding: 0.25rem;
      line-height: 1;
      transition: color 0.2s ease;
    }

    .modal-close:hover {
      color: var(--text);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      background: var(--bg);
      border-radius: 0 0 var(--radius) var(--radius);
    }

    /* Profile Projects Section */
    .profile-projects {
      padding: 1.5rem;
      border-top: 1px solid var(--border);
      background: var(--bg);
    }

    .projects-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .projects-title::before {
      content: '';
      width: 4px;
      height: 20px;
      background: var(--brand);
      border-radius: 2px;
    }

    .projects-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .project-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--card);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      transition: all 0.2s ease;
    }

         .project-item:hover {
       border-color: var(--brand);
       box-shadow: 0 2px 8px rgba(255, 107, 0, 0.1);
     }
     
     .project-item.clickable {
       cursor: pointer;
       transition: all 0.2s ease;
     }
     
     .project-item.clickable:hover {
       transform: translateY(-2px);
       box-shadow: 0 4px 12px rgba(255, 107, 0, 0.15);
     }

    .project-icon {
      width: 40px;
      height: 40px;
      background: var(--brand);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .project-info {
      flex: 1;
      min-width: 0;
    }

    .project-name {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.25rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .project-description {
      font-size: 0.85rem;
      color: var(--muted);
      margin: 0;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .no-projects {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--muted);
    }

    .no-projects i {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .no-projects p {
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .no-projects small {
      font-size: 0.8rem;
      opacity: 0.8;
    }

    /* Project Access Information */
    .project-access-info {
      background: var(--bg);
      border-radius: var(--radius-sm);
      padding: 1rem;
    }

    .access-summary {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .access-count {
      font-weight: 600;
      color: var(--text);
    }

    .project-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .project-tag {
      background: var(--brand);
      color: #fff;
      padding: 0.25rem 0.75rem;
      border-radius: var(--radius-xs);
      font-size: 0.8rem;
      font-weight: 500;
    }

    .no-access {
      text-align: center;
      padding: 1rem;
    }

    .no-access small {
      display: block;
      margin-top: 0.5rem;
      color: var(--muted);
      font-size: 0.8rem;
    }

    /* Quick Access Section */
    .quick-access {
      padding: 1.5rem;
      border-top: 1px solid var(--border);
      background: var(--card);
    }

    .quick-access-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .quick-access-title::before {
      content: '';
      width: 3px;
      height: 16px;
      background: var(--brand);
      border-radius: 1.5px;
    }

    .quick-access-links {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .quick-access-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg);
      border-radius: var(--radius-sm);
      color: var(--text);
      text-decoration: none;
      transition: all 0.2s ease;
      font-size: 0.9rem;
    }

    .quick-access-link:hover {
      background: var(--brand);
      color: #fff;
      transform: translateX(4px);
    }

    .quick-access-link i {
      font-size: 0.8rem;
      opacity: 0.8;
    }

    /* Profile Details */
    .profile-details {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2rem;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-label {
      display: block;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      transition: all 0.2s ease;
      background: var(--card);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
    }

    .form-control[readonly] {
      background: var(--bg);
      color: var(--muted);
      cursor: not-allowed;
    }

    textarea.form-control {
      resize: vertical;
      min-height: 100px;
    }

    .form-help {
      font-size: 0.875rem;
      color: var(--muted);
      margin-top: 0.25rem;
    }

    .form-actions {
      grid-column: 1 / -1;
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--brand);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--brand-d);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--secondary);
      color: #fff;
    }

    .btn-secondary:hover {
      background: var(--muted);
    }

    .btn-outline {
      background: transparent;
      color: var(--brand);
      border: 2px solid var(--brand);
    }

    .btn-outline:hover {
      background: var(--brand);
      color: #fff;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .profile-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .form-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .main-content {
        padding: 1rem;
      }

      .profile-header {
        padding: 1.5rem;
      }

      .profile-avatar {
        width: 100px;
        height: 100px;
        font-size: 2.5rem;
      }

      .form-actions {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .profile-projects {
        padding: 1rem;
      }

      .project-item {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
      }

      .project-icon {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
      }

      .quick-access {
        padding: 1rem;
      }

      .quick-access-links {
        gap: 0.75rem;
      }

      .quick-access-link {
        justify-content: center;
      }
    }

    /* Status Indicators */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: var(--radius-xs);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .status-verified {
      background: rgba(22, 163, 74, 0.1);
      color: var(--success);
    }

    .status-pending {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .status-admin {
      background: rgba(14, 165, 233, 0.1);
      color: var(--info);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--muted);
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-state h3 {
      margin-bottom: 0.5rem;
      color: var(--text);
    }

    /* Notification System */
    .notification-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      max-width: 400px;
    }

    .notification {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      padding: 1.25rem;
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      animation: slideInRight 0.3s ease-out;
      border-left: 4px solid;
      position: relative;
      overflow: hidden;
    }

    .notification.success {
      border-left-color: var(--success);
      background: linear-gradient(to right, rgba(22, 163, 74, 0.05), var(--card));
    }

    .notification.error {
      border-left-color: #ef4444;
      background: linear-gradient(to right, rgba(239, 68, 68, 0.05), var(--card));
    }

    .notification.warning {
      border-left-color: var(--warning);
      background: linear-gradient(to right, rgba(245, 158, 11, 0.05), var(--card));
    }

    .notification.info {
      border-left-color: var(--info);
      background: linear-gradient(to right, rgba(14, 165, 233, 0.05), var(--card));
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    .notification.hiding {
      animation: slideOutRight 0.3s ease-out forwards;
    }

    .notification-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .notification.success .notification-icon {
      color: var(--success);
    }

    .notification.error .notification-icon {
      color: #ef4444;
    }

    .notification.warning .notification-icon {
      color: var(--warning);
    }

    .notification.info .notification-icon {
      color: var(--info);
    }

    .notification-content {
      flex: 1;
    }

    .notification-title {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
      color: var(--text);
    }

    .notification-message {
      font-size: 0.9rem;
      color: var(--muted);
      line-height: 1.5;
    }

    .notification-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: none;
      border: none;
      font-size: 1.2rem;
      color: var(--muted);
      cursor: pointer;
      padding: 0.25rem;
      line-height: 1;
      transition: color 0.2s;
    }

    .notification-close:hover {
      color: var(--text);
    }

    .notification-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: currentColor;
      opacity: 0.3;
      animation: progressBar 10s linear forwards;
    }

    @keyframes progressBar {
      from {
        width: 100%;
      }
      to {
        width: 0%;
      }
    }

    /* Required Fields Warning Banner */
    .required-fields-banner {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: #fff;
      padding: 1.25rem 1.5rem;
      border-radius: var(--radius);
      margin-bottom: 2rem;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      display: flex;
      align-items: center;
      gap: 1rem;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      }
      50% {
        box-shadow: 0 4px 20px rgba(245, 158, 11, 0.5);
      }
    }

    .required-fields-banner i {
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .required-fields-content {
      flex: 1;
    }

    .required-fields-title {
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .required-fields-list {
      font-size: 0.95rem;
      opacity: 0.95;
      margin-top: 0.5rem;
    }

    .required-fields-list strong {
      font-weight: 600;
    }

    .required-fields-banner .btn-close-banner {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: #fff;
      padding: 0.5rem;
      border-radius: var(--radius-xs);
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .required-fields-banner .btn-close-banner:hover {
      background: rgba(255, 255, 255, 0.3);
    }
  </style>
</head>
<body>
  <!-- Notification Container -->
  <div class="notification-container" id="notificationContainer"></div>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a href="{% url 'landing' %}" class="logo">
        <img src="{% static 'core/images/logo.png' %}" alt="MCS Logo" onerror="this.style.display='none'">
        <span class="logo-text">MCS</span>
      </a>
      
      <div class="user-menu">
        <button class="user-button" onclick="toggleDropdown()">
          <div class="user-avatar">
            {% if user.profile.photo %}
              <img src="{{ user.profile.photo.url }}" alt="Profile Photo">
            {% else %}
              {{ user.profile.initials|default:user.username|first|upper }}
            {% endif %}
          </div>
          <span>{{ user.first_name|default:user.get_username }}</span>
          <i class="fas fa-chevron-down"></i>
        </button>
        
        <div class="dropdown" id="userDropdown">
          <a href="{% url 'landing' %}" class="dropdown-item">
            <i class="fas fa-home"></i>
            Dashboard
          </a>
          <a href="{% url 'profile' %}" class="dropdown-item">
            <i class="fas fa-user"></i>
            Profile
          </a>
          <a href="{% url 'accounts:logout' %}" class="dropdown-item">
            <i class="fas fa-sign-out-alt"></i>
            Logout
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">{{ user.first_name|title|default:user.get_username|title }}'s Profile</h1>
      <p class="page-subtitle">Manage your account information and preferences</p>
    </div>

    <!-- Required Fields Warning Banner -->
    {% if has_missing_fields %}
    <div class="required-fields-banner" id="requiredFieldsBanner">
      <i class="fas fa-exclamation-triangle"></i>
      <div class="required-fields-content">
        <div class="required-fields-title">⚠️ Complete Your Profile</div>
        <div class="required-fields-list">
          Please provide the following information to use all features:
          <strong>{{ missing_fields|join:", " }}</strong>
        </div>
      </div>
      <button type="button" class="btn-close-banner" onclick="document.getElementById('requiredFieldsBanner').style.display='none'">
        <i class="fas fa-times"></i>
      </button>
    </div>
    {% endif %}

    <!-- Django Messages Display -->
    {% if messages %}
      {% for message in messages %}
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            showNotification('{{ message.tags|default:"info" }}', '{{ message|escapejs }}');
          });
        </script>
      {% endfor %}
    {% endif %}

    <!-- Profile Grid -->
    <div class="profile-grid">
      <!-- Profile Card -->
      <div class="profile-card">
        <div class="profile-header">
          <div class="profile-avatar">
            {% if user.profile.photo %}
              <img src="{{ user.profile.photo.url }}" alt="Profile Photo">
            {% else %}
              {{ user.profile.initials|default:user.username|first|upper }}
            {% endif %}
          </div>
          <h2 class="profile-name">{{ user.first_name|default:user.profile.display_name|default:user.get_username }}</h2>
          <p class="profile-username">@{{ user.get_username }}</p>
        </div>
        
        <div class="profile-stats">
          <div class="stat-item">
            <div class="stat-value">UGX {{ user.profile.get_current_year_amount_saved|default:0|floatformat:0|intcomma }}</div>
            <div class="stat-label">Amount Saved</div>
            <div class="stat-note" style="font-size: 0.75rem; color: var(--muted); margin-top: 0.25rem;">Current year deposits only</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">UGX {{ user.profile.get_current_year_daily_interest|default:0|floatformat:0|intcomma }}</div>
            <div class="stat-label">Interest Earned</div>
            <div class="stat-note" style="font-size: 0.75rem; color: var(--muted); margin-top: 0.25rem;">15% annualized daily interest</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">UGX {{ user.profile.get_current_year_total_savings_and_interest|default:0|floatformat:0|intcomma }}</div>
            <div class="stat-label">Total Savings and Interest</div>
            <div class="stat-note" style="font-size: 0.75rem; color: var(--muted); margin-top: 0.25rem;">Current year deposits + daily interest</div>
          </div>
        </div>
        
        <!-- Available Balance & Withheld Amounts Section -->
        <div class="balance-section">
          <div class="available-balance-card">
            <div class="balance-header">
              <i class="fas fa-wallet"></i>
              <h4 class="balance-title">Available Balance</h4>
            </div>
            <div class="balance-amount">
              UGX {{ user.profile.get_available_balance|default:0|floatformat:0|intcomma }}
            </div>
            <p class="balance-description">Amount available for withdrawal (from last year's matured savings + interest)</p>
          </div>
          
          {% if user.profile.get_total_withheld_amount > 0 %}
          <div class="withheld-amounts-card">
            <div class="withheld-header">
              <i class="fas fa-lock"></i>
              <h4 class="withheld-title">Funds Withheld</h4>
            </div>
            <div class="withheld-list">
              {% if user.profile.get_pending_withdrawal_amount > 0 %}
              <div class="withheld-item">
                <div class="withheld-item-icon withdraw">
                  <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="withheld-item-content">
                  <div class="withheld-item-label">Pending Withdrawals</div>
                  <div class="withheld-item-amount">UGX {{ user.profile.get_pending_withdrawal_amount|default:0|floatformat:0|intcomma }}</div>
                </div>
              </div>
              {% endif %}
              
              {% if user.profile.get_pending_gwc_amount > 0 %}
              <div class="withheld-item">
                <div class="withheld-item-icon gwc">
                  <i class="fas fa-users"></i>
                </div>
                <div class="withheld-item-content">
                  <div class="withheld-item-label">Pending GWC Contributions</div>
                  <div class="withheld-item-amount">UGX {{ user.profile.get_pending_gwc_amount|default:0|floatformat:0|intcomma }}</div>
                </div>
              </div>
              {% endif %}
              
              {% if user.profile.get_pending_mesu_amount > 0 %}
              <div class="withheld-item">
                <div class="withheld-item-icon mesu">
                  <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="withheld-item-content">
                  <div class="withheld-item-label">Pending MESU Investments</div>
                  <div class="withheld-item-amount">UGX {{ user.profile.get_pending_mesu_amount|default:0|floatformat:0|intcomma }}</div>
                </div>
              </div>
              {% endif %}
              
              <div class="withheld-total">
                <div class="withheld-total-label">Total Withheld</div>
                <div class="withheld-total-amount">UGX {{ user.profile.get_total_withheld_amount|default:0|floatformat:0|intcomma }}</div>
              </div>
            </div>
          </div>
          {% endif %}
        </div>

        <!-- Savings Actions Section -->
        <div class="profile-actions">
          <h4 class="actions-title">What would you like to do with your savings?</h4>
          <div class="actions-grid">
            <button class="action-btn action-withdraw" onclick="openWithdrawModal()">
              <div class="action-icon">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="action-content">
                <h5 class="action-name">Withdraw</h5>
                <p class="action-description">Request withdrawal of your savings and interest</p>
              </div>
              <i class="fas fa-chevron-right action-arrow"></i>
            </button>
            
            <button class="action-btn action-gwc" onclick="openGWCModal()">
              <div class="action-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="action-content">
                <h5 class="action-name">Join GWC Group</h5>
                <p class="action-description">Join a Generational Wealth Creation group</p>
              </div>
              <i class="fas fa-chevron-right action-arrow"></i>
            </button>
            
            <button class="action-btn action-mesu" onclick="openMESUModal()">
              <div class="action-icon">
                <i class="fas fa-graduation-cap"></i>
              </div>
              <div class="action-content">
                <h5 class="action-name">Buy MESU Shares</h5>
                <p class="action-description">Invest in MESU Academy shares</p>
              </div>
              <i class="fas fa-chevron-right action-arrow"></i>
            </button>
          </div>
        </div>
        
        <!-- User Projects Section -->
        <div class="profile-projects">
          <h4 class="projects-title">My Projects</h4>
          {% if user_projects %}
            <div class="projects-list">
                             {% for project in user_projects %}
                 <div class="project-item{% if project.name == '52 Weeks Saving Challenge' %} clickable{% endif %}">
                   <div class="project-icon">
                     <i class="fas fa-folder"></i>
                   </div>
                   <div class="project-info">
                     <h5 class="project-name">
                       {% if project.name == '52 Weeks Saving Challenge' %}
                         <a href="{% url 'savings_52_weeks:group_dashboard' %}" style="color: inherit; text-decoration: none;">
                           {{ project.name }} <i class="fas fa-external-link-alt" style="font-size: 0.8em; opacity: 0.7;"></i>
                         </a>
                       {% else %}
                         {{ project.name }}
                       {% endif %}
                     </h5>
                     <p class="project-description">{{ project.description|default:"No description available" }}</p>
                   </div>
                 </div>
               {% endfor %}
            </div>
          {% else %}
            <div class="no-projects">
              <i class="fas fa-folder-open"></i>
              <p>No projects assigned yet</p>
              <small>Contact your administrator to get access to projects</small>
            </div>
          {% endif %}
        </div>
        
        <!-- Quick Access Section -->
        {% if user_projects %}
          <div class="quick-access">
            <h5 class="quick-access-title">Quick Access</h5>
            <div class="quick-access-links">
              {% for project in user_projects %}
                <a href="{% if project.name == '52 Weeks Saving Challenge' %}{% url 'savings_52_weeks:group_dashboard' %}{% else %}#{% endif %}" class="quick-access-link" title="{{ project.name }}">
                  <i class="fas fa-external-link-alt"></i>
                  <span>{{ project.name }}</span>
                </a>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>

      <!-- Profile Details -->
      <div class="profile-details">
        <h3 class="section-title">Profile Information</h3>
        
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          
          <div class="form-grid">
            <!-- Basic Information -->
            <div class="form-group">
              <label class="form-label">First Name</label>
              <input type="text" class="form-control" name="first_name" value="{{ user.first_name }}" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">Last Name</label>
              <input type="text" class="form-control" name="last_name" value="{{ user.last_name }}" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">Username</label>
              <input type="text" class="form-control" value="{{ user.username }}" readonly>
              <div class="form-help">Username cannot be changed</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" name="email" value="{{ user.email }}" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">Account Number</label>
              <input type="text" class="form-control" value="{{ user.profile.account_number|default:'Not assigned' }}" readonly>
              <div class="form-help">Auto-generated account number</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Member Since</label>
              <input type="text" class="form-control" value="{{ user.profile.created_at|date:'F j, Y' }}" readonly>
            </div>
            
            <!-- Contact Information -->
            <div class="form-group">
              <label class="form-label">WhatsApp Number <span style="color: #dc2626;">*</span></label>
              <input type="tel" class="form-control" name="whatsapp_number" value="{{ user.profile.whatsapp_number|default:'' }}" placeholder="+2567XXXXXXXX" required>
              <div class="form-help">Include country code (e.g., +256). Required for contact purposes.</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">National ID</label>
              <input type="text" class="form-control" name="national_id" value="{{ user.profile.national_id|default:'' }}" placeholder="National ID Number">
              <div class="form-help">Optional: Your National ID number</div>
            </div>
            
            <div class="form-group full-width">
              <label class="form-label">Address</label>
              <textarea class="form-control" name="address" placeholder="Your address">{{ user.profile.address|default:'' }}</textarea>
            </div>
            
            <div class="form-group full-width">
              <label class="form-label">Bio</label>
              <textarea class="form-control" name="bio" placeholder="Tell us about yourself">{{ user.profile.bio|default:'' }}</textarea>
            </div>
            
            <div class="form-group">
              <label class="form-label">Date of Birth</label>
              <input type="date" class="form-control" name="birthdate" value="{{ user.profile.birthdate|date:'Y-m-d'|default:'' }}">
              {% if user.profile.age %}
                <div class="form-help">Age: {{ user.profile.age }} years old</div>
              {% endif %}
            </div>
            
            <div class="form-group">
              <label class="form-label">Profile Photo</label>
              <input type="file" class="form-control" name="photo" accept="image/*">
              <div class="form-help">Upload a profile picture (JPG, PNG)</div>
            </div>
            
            <!-- Bank Account Information -->
            <div class="form-group full-width">
              <label class="form-label" style="font-size: 1.1rem; color: var(--brand); margin-top: 1rem; padding-top: 1.5rem; border-top: 2px solid var(--border);">
                <i class="fas fa-university"></i>
                Bank Account Information
              </label>
              <div class="form-help" style="margin-bottom: 1rem;">Required for withdrawals and payments. Admin will use these details to send money.</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Bank Name</label>
              <input type="text" class="form-control" name="bank_name" value="{{ user.profile.bank_name|default:'' }}" placeholder="e.g., Centenary Bank, Stanbic Bank">
              <div class="form-help">Name of your bank</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Account Number</label>
              <input type="text" class="form-control" name="bank_account_number" value="{{ user.profile.bank_account_number|default:'' }}" placeholder="Your bank account number">
              <div class="form-help">Your bank account number</div>
            </div>
            
            <div class="form-group full-width">
              <label class="form-label">Account Name</label>
              <input type="text" class="form-control" name="bank_account_name" value="{{ user.profile.bank_account_name|default:'' }}" placeholder="Name as it appears on your bank account">
              <div class="form-help">Name exactly as it appears on your bank account</div>
            </div>
            
            <!-- Status Information -->
            <div class="form-group">
              <label class="form-label">Verification Status</label>
              <div class="status-badge {% if user.profile.is_verified %}status-verified{% else %}status-pending{% endif %}">
                <i class="fas {% if user.profile.is_verified %}fa-check-circle{% else %}fa-clock{% endif %}"></i>
                {% if user.profile.is_verified %}Verified{% else %}Pending Verification{% endif %}
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Account Type</label>
              <div class="status-badge {% if user.profile.is_admin %}status-admin{% else %}status-verified{% endif %}">
                <i class="fas {% if user.profile.is_admin %}fa-shield-alt{% else %}fa-user{% endif %}"></i>
                {% if user.profile.is_admin %}Administrator{% else %}Member{% endif %}
              </div>
            </div>
            
            <!-- Project Access Information -->
            <div class="form-group full-width">
              <label class="form-label">Project Access</label>
              <div class="project-access-info">
                {% if user_projects %}
                  <div class="access-summary">
                    <span class="access-count">{{ user_projects|length }} project{{ user_projects|length|pluralize:"s" }} accessible</span>
                    <span class="access-status status-verified">
                      <i class="fas fa-check-circle"></i>
                      Active Access
                    </span>
                  </div>
                  <div class="project-tags">
                    {% for project in user_projects %}
                      <span class="project-tag">{{ project.name }}</span>
                    {% endfor %}
                  </div>
                {% else %}
                  <div class="no-access">
                    <span class="access-status status-pending">
                      <i class="fas fa-clock"></i>
                      No Projects Assigned
                    </span>
                    <small>Contact your administrator to request project access</small>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
          
          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn btn-outline" onclick="resetForm()">
              <i class="fas fa-undo"></i>
              Reset
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <!-- Withdraw Modal -->
  <div id="withdrawModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fas fa-money-bill-wave"></i>
          Request Withdrawal
        </h3>
        <button class="modal-close" onclick="closeWithdrawModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="withdrawForm" method="post" action="{% url 'profile' %}">
          {% csrf_token %}
          <input type="hidden" name="action" value="withdraw">
          
            <div class="form-group">
              <label class="form-label">Available Balance</label>
              <input type="text" class="form-control" value="UGX {{ user.profile.get_available_balance|default:0|floatformat:0|intcomma }}" readonly>
              <div class="form-help">Amount available for withdrawal (after deducting pending requests)</div>
            </div>
          
          <div class="form-group">
            <label class="form-label">Withdrawal Amount (UGX)</label>
            <input type="number" class="form-control" name="withdraw_amount" min="1000" step="1000" required placeholder="Enter amount">
            <div class="form-help">Minimum withdrawal: UGX 1,000</div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Reason (Optional)</label>
            <textarea class="form-control" name="withdraw_reason" rows="3" placeholder="Reason for withdrawal"></textarea>
          </div>
          
          <div class="info-card" style="margin-top: 1rem;">
            <h4 style="color: var(--brand-d); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-info-circle"></i>
              Important
            </h4>
            <p style="color: #9a3412; margin: 0; line-height: 1.6; font-size: 0.9rem;">
              Please ensure your bank account details are up to date in your profile. Withdrawals are subject to admin approval and may take 1-3 business days to process.
            </p>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="closeWithdrawModal()">Cancel</button>
        <button type="submit" form="withdrawForm" class="btn btn-primary">
          <i class="fas fa-paper-plane"></i>
          Submit Request
        </button>
      </div>
    </div>
  </div>

  <!-- Join GWC Modal -->
  <div id="gwcModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fas fa-users"></i>
          Join GWC Group
        </h3>
        <button class="modal-close" onclick="closeGWCModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="gwcForm" method="post" action="{% url 'profile' %}">
          {% csrf_token %}
          <input type="hidden" name="action" value="join_gwc">
          
            <div class="form-group">
              <label class="form-label">Available Balance</label>
              <input type="text" class="form-control" value="UGX {{ user.profile.get_available_balance|default:0|floatformat:0|intcomma }}" readonly>
              <div class="form-help">Amount available for withdrawal (after deducting pending requests)</div>
            </div>
          
          <div class="form-group">
            <label class="form-label">Contribution Amount (UGX)</label>
            <input type="number" class="form-control" name="gwc_amount" min="1000" step="1000" required placeholder="Enter contribution amount">
            <div class="form-help">Minimum contribution: UGX 1,000</div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Group Type</label>
            <select class="form-control" name="gwc_group_type" required>
              <option value="">Select group type</option>
              <option value="individual">Individual Contribution</option>
              <option value="group">Group Contribution</option>
            </select>
            <div class="form-help">Choose how you want to contribute</div>
          </div>
          
          <div class="info-card" style="margin-top: 1rem;">
            <h4 style="color: var(--brand-d); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-info-circle"></i>
              About GWC
            </h4>
            <p style="color: #9a3412; margin: 0; line-height: 1.6; font-size: 0.9rem;">
              Generational Wealth Creation (GWC) groups help members build wealth together. Your contribution will be used to join or create a GWC group. Minimum group target is UGX 120,000,000.
            </p>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="closeGWCModal()">Cancel</button>
        <button type="submit" form="gwcForm" class="btn btn-primary">
          <i class="fas fa-users"></i>
          Join Group
        </button>
      </div>
    </div>
  </div>

  <!-- Buy MESU Shares Modal -->
  <div id="mesuModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fas fa-graduation-cap"></i>
          Buy MESU Academy Shares
        </h3>
        <button class="modal-close" onclick="closeMESUModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="mesuForm" method="post" action="{% url 'profile' %}">
          {% csrf_token %}
          <input type="hidden" name="action" value="buy_mesu">
          
            <div class="form-group">
              <label class="form-label">Available Balance</label>
              <input type="text" class="form-control" value="UGX {{ user.profile.get_available_balance|default:0|floatformat:0|intcomma }}" readonly>
              <div class="form-help">Amount available for withdrawal (after deducting pending requests)</div>
            </div>
          
          <div class="form-group">
            <label class="form-label">Investment Amount (UGX)</label>
            <input type="number" class="form-control" name="mesu_amount" id="mesuAmount" min="1000000" step="1000000" required placeholder="Enter investment amount (multiples of 1,000,000)">
            <div class="form-help">Minimum investment: UGX 1,000,000 (1 share). Each share costs UGX 1,000,000</div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Number of Shares</label>
            <input type="number" class="form-control" name="mesu_shares" id="mesuShares" min="1" step="1" placeholder="Will be calculated automatically" readonly>
            <div class="form-help">Number of shares will be calculated automatically (1 share = UGX 1,000,000)</div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Additional Notes (Optional)</label>
            <textarea class="form-control" name="mesu_notes" rows="3" placeholder="Any additional information or questions"></textarea>
          </div>
          
          <div class="info-card" style="margin-top: 1rem;">
            <h4 style="color: var(--brand-d); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-info-circle"></i>
              About MESU Academy
            </h4>
            <p style="color: #9a3412; margin: 0; line-height: 1.6; font-size: 0.9rem;">
              MESU Academy offers investment opportunities through share purchases. Each share costs UGX 1,000,000. Your investment will be held pending admin approval. Once approved, the amount will be deducted from your savings.
            </p>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="closeMESUModal()">Cancel</button>
        <button type="submit" form="mesuForm" class="btn btn-primary">
          <i class="fas fa-graduation-cap"></i>
          Express Interest
        </button>
      </div>
    </div>
  </div>

  <script>
    // Toggle user dropdown
    function toggleDropdown() {
      const dropdown = document.getElementById('userDropdown');
      dropdown.classList.toggle('show');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('userDropdown');
      const userButton = event.target.closest('.user-button');
      
      if (!userButton) {
        dropdown.classList.remove('show');
      }
    });

    // Reset form to original values
    function resetForm() {
      if (confirm('Are you sure you want to reset all changes?')) {
        location.reload();
      }
    }

    // Modal functions
    function openWithdrawModal() {
      document.getElementById('withdrawModal').classList.add('show');
    }

    function closeWithdrawModal() {
      document.getElementById('withdrawModal').classList.remove('show');
    }

    function openGWCModal() {
      document.getElementById('gwcModal').classList.add('show');
    }

    function closeGWCModal() {
      document.getElementById('gwcModal').classList.remove('show');
    }

    function openMESUModal() {
      document.getElementById('mesuModal').classList.add('show');
    }

    function closeMESUModal() {
      document.getElementById('mesuModal').classList.remove('show');
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
      const withdrawModal = document.getElementById('withdrawModal');
      const gwcModal = document.getElementById('gwcModal');
      const mesuModal = document.getElementById('mesuModal');
      
      if (event.target == withdrawModal) {
        closeWithdrawModal();
      }
      if (event.target == gwcModal) {
        closeGWCModal();
      }
      if (event.target == mesuModal) {
        closeMESUModal();
      }
    }

    // Calculate MESU shares automatically (1 share = 1,000,000 UGX)
    document.addEventListener('DOMContentLoaded', function() {
      const mesuAmountInput = document.getElementById('mesuAmount');
      const mesuSharesInput = document.getElementById('mesuShares');
      
      if (mesuAmountInput && mesuSharesInput) {
        mesuAmountInput.addEventListener('input', function() {
          const amount = parseFloat(this.value) || 0;
          const shares = Math.floor(amount / 1000000);
          mesuSharesInput.value = shares;
        });
      }
    });

    // Notification System
    function showNotification(type, message, title = null) {
      const container = document.getElementById('notificationContainer');
      if (!container) return;

      // Determine icon and default title based on type
      const icons = {
        'success': 'fa-check-circle',
        'error': 'fa-exclamation-circle',
        'warning': 'fa-exclamation-triangle',
        'info': 'fa-info-circle'
      };

      const defaultTitles = {
        'success': 'Success!',
        'error': 'Error',
        'warning': 'Warning',
        'info': 'Information'
      };

      const icon = icons[type] || icons.info;
      const notificationTitle = title || defaultTitles[type] || 'Notification';

      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <i class="fas ${icon} notification-icon"></i>
        <div class="notification-content">
          <div class="notification-title">${notificationTitle}</div>
          <div class="notification-message">${message}</div>
        </div>
        <button type="button" class="notification-close" onclick="closeNotification(this)">
          <i class="fas fa-times"></i>
        </button>
        <div class="notification-progress"></div>
      `;

      container.appendChild(notification);

      // Auto-remove after 10 seconds
      setTimeout(() => {
        closeNotification(notification.querySelector('.notification-close'));
      }, 10000);
    }

    function closeNotification(button) {
      const notification = button.closest('.notification');
      if (notification) {
        notification.classList.add('hiding');
        setTimeout(() => {
          notification.remove();
        }, 300);
      }
    }

    // Enhanced success notifications for specific actions
    document.addEventListener('DOMContentLoaded', function() {
      // Check URL parameters for action success
      const urlParams = new URLSearchParams(window.location.search);
      const action = urlParams.get('action');
      
      if (action === 'withdraw_success') {
        const amount = urlParams.get('amount') || '';
        showNotification('success', 
          `Your withdrawal request of UGX ${amount} has been submitted successfully! The admin will process it within 1-3 business days.`,
          'Withdrawal Request Submitted'
        );
      } else if (action === 'gwc_success') {
        const amount = urlParams.get('amount') || '';
        const type = urlParams.get('type') || '';
        showNotification('success',
          `Your GWC contribution request of UGX ${amount} (${type}) has been submitted successfully! Admin will review your request.`,
          'GWC Contribution Submitted'
        );
      } else if (action === 'mesu_success') {
        const shares = urlParams.get('shares') || '';
        const amount = urlParams.get('amount') || '';
        showNotification('success',
          `Your interest in MESU shares (${shares} share(s) = UGX ${amount}) has been submitted successfully! Admin will review your request.`,
          'MESU Investment Interest Submitted'
        );
      }
      
      // Make 52WSC project items clickable
      const clickableProjects = document.querySelectorAll('.project-item.clickable');
      clickableProjects.forEach(project => {
        project.addEventListener('click', function() {
          const link = this.querySelector('a');
          if (link) {
            window.location.href = link.href;
          }
        });
      });
    });
  </script>
</body>
</html>
